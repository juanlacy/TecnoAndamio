<div class="password-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>
      <mat-icon>vpn_key</mat-icon>
      Cambiar Contraseña
    </h2>
    <button mat-icon-button (click)="onCancel()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <div class="user-info">
      <mat-icon>person</mat-icon>
      <span>{{ data.usuarioNombre }}</span>
    </div>

    <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
      <!-- Nueva contraseña -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nueva Contraseña</mat-label>
        <input
          matInput
          [type]="showPassword() ? 'text' : 'password'"
          formControlName="newPassword"
          placeholder="Mínimo 6 caracteres"
          autocomplete="new-password"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="togglePasswordVisibility('password')"
        >
          <mat-icon>{{ showPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched) {
          <mat-error>{{ getErrorMessage('newPassword') }}</mat-error>
        }
      </mat-form-field>

      <!-- Confirmar contraseña -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirmar Contraseña</mat-label>
        <input
          matInput
          [type]="showConfirmPassword() ? 'text' : 'password'"
          formControlName="confirmPassword"
          placeholder="Repite la contraseña"
          autocomplete="new-password"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="togglePasswordVisibility('confirm')"
        >
          <mat-icon>{{ showConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (
          passwordForm.get('confirmPassword')?.invalid &&
          passwordForm.get('confirmPassword')?.touched
        ) {
          <mat-error>{{ getErrorMessage('confirmPassword') }}</mat-error>
        }
        @if (
          passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched
        ) {
          <mat-error>Las contraseñas no coinciden</mat-error>
        }
      </mat-form-field>

      <!-- Mensaje de ayuda -->
      <div class="help-text">
        <mat-icon>info</mat-icon>
        <span>La contraseña debe tener al menos 6 caracteres</span>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" [disabled]="loading()">Cancelar</button>

    <button
      mat-raised-button
      color="primary"
      (click)="onSubmit()"
      [disabled]="passwordForm.invalid || loading()"
    >
      <mat-icon class="spinning" *ngIf="loading()">sync</mat-icon>
      <mat-icon *ngIf="!loading()">save</mat-icon>

      <span>
        @if (loading()) {
          Cambiando...
        } @else {
          Cambiar Contraseña
        }
      </span>
    </button>
  </mat-dialog-actions>
</div>
