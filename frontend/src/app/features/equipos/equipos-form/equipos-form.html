<div class="form-container">
  <div class="page-header">
    <button mat-icon-button (click)="onCancel()" class="back-btn">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1>
      <mat-icon>{{ isEditMode() ? 'edit' : 'add' }}</mat-icon>
      {{ isEditMode() ? 'Editar Equipo' : 'Nuevo Equipo' }}
    </h1>
  </div>

  @if (loading()) {
    <app-loading />
  } @else {
    <mat-card class="form-card">
      <mat-card-content>
        <form [formGroup]="equipoForm" (ngSubmit)="onSubmit()">
          <div class="form-grid">
            <!-- Categoría -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Categoría</mat-label>
              <mat-select formControlName="categoria_id">
                <mat-option [value]="null">Seleccione una categoría</mat-option>
                @for (categoria of categorias(); track categoria.id) {
                  <mat-option [value]="categoria.id">
                    {{ categoria.nombre }}
                  </mat-option>
                }
              </mat-select>
              <mat-icon matPrefix>category</mat-icon>
              @if (equipoForm.get('categoria_id')?.invalid && equipoForm.get('categoria_id')?.touched) {
                <mat-error>{{ getErrorMessage('categoria_id') }}</mat-error>
              }
            </mat-form-field>

            <!-- Nombre -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nombre del Equipo</mat-label>
              <input matInput formControlName="nombre" placeholder="Ej: Andamio Tubular">
              <mat-icon matPrefix>construction</mat-icon>
              @if (equipoForm.get('nombre')?.invalid && equipoForm.get('nombre')?.touched) {
                <mat-error>{{ getErrorMessage('nombre') }}</mat-error>
              }
            </mat-form-field>

            <!-- Código -->
            <mat-form-field appearance="outline">
              <mat-label>Código (Opcional)</mat-label>
              <input matInput formControlName="codigo" placeholder="Ej: AND-001">
              <mat-icon matPrefix>qr_code</mat-icon>
            </mat-form-field>

            <!-- Descripción -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Descripción</mat-label>
              <textarea matInput formControlName="descripcion"
                        rows="3"
                        placeholder="Descripción detallada del equipo..."></textarea>
              <mat-icon matPrefix>description</mat-icon>
            </mat-form-field>

            <!-- Especificaciones (JSON) -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Especificaciones Técnicas (JSON)</mat-label>
              <textarea matInput formControlName="especificaciones"
                        rows="4"
                        placeholder='{"peso": "25kg", "altura": "2m"}'></textarea>
              <mat-icon matPrefix>settings</mat-icon>
              <mat-hint>Puede ser texto libre o formato JSON</mat-hint>
            </mat-form-field>

            <!-- Disponible -->
            <div class="toggle-field">
              <mat-slide-toggle formControlName="disponible" color="primary">
                <div class="toggle-label">
                  <mat-icon>{{ equipoForm.get('disponible')?.value ? 'check_circle' : 'cancel' }}</mat-icon>
                  <span>Disponible para uso</span>
                </div>
              </mat-slide-toggle>
            </div>

            <!-- Activo -->
            <div class="toggle-field">
              <mat-slide-toggle formControlName="activo" color="accent">
                <div class="toggle-label">
                  <mat-icon>{{ equipoForm.get('activo')?.value ? 'visibility' : 'visibility_off' }}</mat-icon>
                  <span>Equipo activo</span>
                </div>
              </mat-slide-toggle>
            </div>
          </div>

          <!-- Botones -->
          <div class="form-actions">
            <button mat-stroked-button type="button" (click)="onCancel()">
              <mat-icon>close</mat-icon>
              Cancelar
            </button>
            <button mat-raised-button color="primary" type="submit" [disabled]="loading()">
              <mat-icon>{{ isEditMode() ? 'save' : 'add' }}</mat-icon>
              {{ isEditMode() ? 'Guardar Cambios' : 'Crear Equipo' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  }
</div>
